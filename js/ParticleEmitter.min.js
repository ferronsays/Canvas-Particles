ParticleEmitter=function(a){this.init(a)},ParticleEmitter.prototype.init=function(a){this.settings={context:null,blendMode:"normal",radial:!1,sharpness:0,sharpnessVariance:0,maxParticles:0,position:new Vector2D(0,0),positionVariance:new Vector2D(0,0),circularDistribution:!1,radius:0,direction:0,directionVariance:0,speed:0,speedVariance:0,size:0,sizeVariance:0,endSize:0,endSizeVariance:0,life:0,lifeVariance:0,color:[0,0,0,0],colorVariance:[0,0,0,0],endColor:[0,0,0,0],endColorVariance:[0,0,0,0],duration:-1,gravitate:!0,forceVector:new Vector2D(0,0)},this.particles=[],this.emitCounter=0,this.elapsedTime=0,this.alive=!0;for(var b in a)a.hasOwnProperty(b)&&(this.settings[b]=a[b])},ParticleEmitter.prototype.update=function(a){if(0===this.settings.duration)this.particles.length<=0&&this.kill();else{var b=this.settings.maxParticles/this.settings.life;if(this.settings.alive&&b>0){var c=1/b;for(this.emitCounter+=a;this.particles.length<this.settings.maxParticles&&this.emitCounter>c;)this.emitParticle(),this.emitCounter-=c;this.elapsedTime+=a,-1!=this.settings.duration&&this.settings.duration<this.elapsedTime&&this.kill()}}for(var d=this.particles.length;d--;){var e=this.particles[d];e.update(a),e.settings.alive||this.particles.splice(d,1)}},ParticleEmitter.prototype.draw=function(){for(var a=this.particles.length;a--;){var b=this.particles[a];b.draw()}},ParticleEmitter.prototype.emitParticle=function(){var a;this.settings.circularDistribution?a=pointInCircleAround(this.settings.position.duplicate(),this.settings.radius):(a=this.settings.position.duplicate(),a.x=a.x+this.settings.positionVariance.x*Pollock.randomNegativeOneToOne(),a.y=a.y+this.settings.positionVariance.y*Pollock.randomNegativeOneToOne());var b=this.settings.direction+this.settings.directionVariance*Pollock.randomNegativeOneToOne(),c=this.settings.speed+this.settings.speedVariance*Pollock.randomNegativeOneToOne(),d=new Vector2D(Math.cos(b),Math.sin(b)).multiply(c),e=this.settings.size+this.settings.sizeVariance*Pollock.randomNegativeOneToOne();e=0>e?0:~~e;var f=this.settings.endSize+this.settings.endSizeVariance*Pollock.randomNegativeOneToOne();f=0>f?0:~~f;var g=this.settings.life+this.settings.lifeVariance*Pollock.randomNegativeOneToOne(),h=(f-e)/g,i=this.settings.sharpness+this.settings.sharpnessVariance*Pollock.randomNegativeOneToOne();i=i>100?100:0>i?0:i;var j=~~(e/200*i),k=[this.settings.color[0]+this.settings.colorVariance[0]*Pollock.randomNegativeOneToOne(),this.settings.color[1]+this.settings.colorVariance[1]*Pollock.randomNegativeOneToOne(),this.settings.color[2]+this.settings.colorVariance[2]*Pollock.randomNegativeOneToOne(),this.settings.color[3]+this.settings.colorVariance[3]*Pollock.randomNegativeOneToOne()],l=[this.settings.endColor[0]+this.settings.endColorVariance[0]*Pollock.randomNegativeOneToOne(),this.settings.endColor[1]+this.settings.endColorVariance[1]*Pollock.randomNegativeOneToOne(),this.settings.endColor[2]+this.settings.endColorVariance[2]*Pollock.randomNegativeOneToOne(),this.settings.endColor[3]+this.settings.endColorVariance[3]*Pollock.randomNegativeOneToOne()],m=k,n=[];n[0]=(l[0]-k[0])/g,n[1]=(l[1]-k[1])/g,n[2]=(l[2]-k[2])/g,n[3]=(l[3]-k[3])/g;var o=new Particle({context:this.settings.context,blendMode:this.settings.blendMode,radial:this.settings.radial,position:a,velocity:d,size:e,deltaSize:h,lifeSpan:g,sharpness:i,inner:j,colorArray:m,deltaColor:n,physical:this.settings.physical,gravitate:this.settings.gravitate,forceVector:this.settings.forceVector});this.particles.push(o)},ParticleEmitter.prototype.kill=function(){this.settings.alive=!1};